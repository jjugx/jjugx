- # 👋 Hi, I’m JUG
![Top Langs](https://github-readme-stats.vercel.app/api/top-langs/?username=jjugx&layout=compact&include_all_commits=true)

<!---
jjugx/jjugx is a ✨ special ✨ repository because its `README.md` (this file) appears on your GitHub profile.
You can click the Preview link to take a look at your changes.
--->

# 📊 สไลด์นำเสนอ: ระบบแก้ไขจุดสำคัญ

## สไลด์ 1: ปัญหา (Problem Statement)
---
### ปัญหาที่พบ
- ❌ AI บางครั้งตรวจจับจุดสำคัญผิดตำแหน่ง
- ❌ ผลการวิเคราะห์ไม่ถูกต้องเนื่องจากจุดสำคัญผิด
- ❌ ต้องการแก้ไขให้ถูกต้องสำหรับการวินิจฉัย

---

## สไลด์ 2: วิธีแก้ปัญหา (Solution)
---
### ระบบแก้ไขจุดสำคัญ
- ✅ แสดงจุดสำคัญที่ AI ตรวจจับได้
- ✅ อนุญาตให้ผู้ใช้แก้ไขตำแหน่งได้
- ✅ คำนวณผลลัพธ์ใหม่ด้วยตำแหน่งที่แก้ไข
- ✅ บันทึกข้อมูลสำหรับพัฒนาต่อ

---

## สไลด์ 3: ภาพรวมการทำงาน
---

```
ผู้ใช้ → แก้ไขจุดสำคัญ → ระบบคำนวณใหม่ → บันทึกข้อมูล
```

**3 ขั้นตอนหลัก:**
1. **การแก้ไข**: ผู้ใช้ลากจุดสำคัญไปตำแหน่งใหม่
2. **การคำนวณ**: ระบบคำนวณผลลัพธ์ใหม่ด้วยตำแหน่งที่แก้ไข
3. **การบันทึก**: เก็บข้อมูลสำหรับการพัฒนาโมเดล

---

## สไลด์ 4: ขั้นตอนการแก้ไข (Detailed Flow)
---

### 4.1 การเริ่มแก้ไข
- กดปุ่ม "Edit Landmarks"
- ระบบแสดงจุดสำคัญพร้อมลากได้

### 4.2 การแก้ไข
- ลากจุดสำคัญไปตำแหน่งที่ถูกต้อง
- ดู Preview ผลลัพธ์ใหม่

### 4.3 การบันทึก
- กดปุ่ม "Save & Recalculate"
- ระบบคำนวณและบันทึกผลลัพธ์ใหม่

---

## สไลด์ 5: การทำงานของ Backend
---

### กระบวนการคำนวณใหม่

```
1. อัปเดตตำแหน่งจุดสำคัญในฐานข้อมูล
   ↓
2. สร้างรูปภาพใหม่ที่มีจุดสำคัญที่แก้ไข
   ↓
3. คำนวณการวิเคราะห์ทันตกรรมใหม่
   ↓
4. คำนวณ ROI Classification ใหม่
   ↓
5. บันทึกข้อมูลสำหรับ Export
```

---

## สไลด์ 6: การเก็บข้อมูล
---

### ข้อมูลที่บันทึก

**1. CorrectedKeypoints Table**
- ตำแหน่งเดิมและตำแหน่งใหม่
- Confidence score
- ผู้ใช้ที่แก้ไข

**2. CorrectedImages Table**
- รูปภาพ original
- Keypoints ทั้งหมด (JSON)
- Metadata

**3. ไฟล์รูปภาพ**
- Original image (copy)
- Result image ที่แก้ไขแล้ว

---

## สไลด์ 7: การ Export ข้อมูล
---

### Admin Panel: Image Management

**ฟีเจอร์:**
- 📋 ดูรายการภาพที่แก้ไขทั้งหมด
- 📦 Export ข้อมูลเป็น ZIP file
- 📊 ดูรายละเอียดแต่ละภาพ

**ข้อมูลที่ Export:**
- รูปภาพ original
- Keypoints พร้อม confidence
- Metadata ครบถ้วน

---

## สไลด์ 8: โครงสร้างไฟล์ Export
---

### ตัวอย่าง ZIP File

```
corrected_image_1.zip
├── image_original.jpg    (รูปภาพ X-ray)
└── data.json             (ข้อมูล keypoints)
    {
      "keypoints": [
        {
          "label": "m1",
          "x": 100.5,
          "y": 200.3,
          "confidence": 0.95
        },
        ...
      ]
    }
```

---

## สไลด์ 9: การใช้งานข้อมูล Export
---

### นำไปใช้สำหรับ

1. **Training Model** 🎓
   - ใช้เป็น ground truth
   - ปรับปรุงโมเดลให้แม่นยำขึ้น

2. **Validation** ✅
   - ตรวจสอบความถูกต้อง
   - ประเมินประสิทธิภาพ

3. **Development** 🔧
   - พัฒนาระบบต่อเนื่อง
   - วิเคราะห์ข้อผิดพลาด

---

## สไลด์ 10: คุณประโยชน์ของระบบ
---

### ผลลัพธ์ที่ได้

✅ **ความแม่นยำสูงขึ้น**
- แก้ไขจุดสำคัญผิดพลาดได้
- ผลการวิเคราะห์ถูกต้องมากขึ้น

✅ **ข้อมูลคุณภาพ**
- เก็บข้อมูลที่แก้ไขแล้ว
- พร้อมใช้สำหรับ training

✅ **การพัฒนาต่อเนื่อง**
- Export ข้อมูลง่าย
- นำไปพัฒนาโมเดลได้ทันที

---

## สไลด์ 11: ตัวอย่างการใช้งาน
---

### ภาพตัวอย่าง

1. **ภาพก่อนแก้ไข**
   - แสดงจุดสำคัญที่ AI ตรวจจับได้
   - บางจุดอาจผิดตำแหน่ง

2. **ภาพขณะแก้ไข**
   - ผู้ใช้กำลังลากจุดสำคัญ
   - ระบบแสดงตำแหน่งใหม่

3. **ภาพหลังแก้ไข**
   - จุดสำคัญอยู่ในตำแหน่งที่ถูกต้อง
   - ผลการวิเคราะห์ใหม่ถูกต้องมากขึ้น

---

## สไลด์ 12: สรุป
---

### ระบบแก้ไขจุดสำคัญ

**หน้าที่:**
- แก้ไขตำแหน่งจุดสำคัญที่ผิดพลาด
- คำนวณผลลัพธ์ใหม่
- เก็บข้อมูลสำหรับพัฒนาโมเดล

**ผลลัพธ์:**
- ✅ ความแม่นยำสูงขึ้น
- ✅ ข้อมูลคุณภาพพร้อมใช้
- ✅ การพัฒนาต่อเนื่อง

---

*เอกสารสำหรับการนำเสนอระบบแก้ไขจุดสำคัญ*



# ระบบแก้ไขจุดสำคัญ (Keypoint Correction System)

## 📋 สารบัญ
1. [ภาพรวมระบบ](#ภาพรวมระบบ)
2. [ขั้นตอนการทำงาน](#ขั้นตอนการทำงาน)
3. [ส่วนประกอบของระบบ](#ส่วนประกอบของระบบ)
4. [การเก็บข้อมูล](#การเก็บข้อมูล)
5. [การ Export ข้อมูล](#การ-export-ข้อมูล)

---

## 🎯 ภาพรวมระบบ

ระบบแก้ไขจุดสำคัญเป็นฟีเจอร์ที่ช่วยให้ผู้ใช้สามารถแก้ไขตำแหน่งจุดสำคัญที่ AI ตรวจจับได้ผิดพลาด โดยระบบจะ:

1. **แสดงจุดสำคัญ** ที่ AI ตรวจจับได้บนภาพ X-ray
2. **อนุญาตให้ผู้ใช้แก้ไข** ตำแหน่งจุดสำคัญด้วยการลาก (drag)
3. **คำนวณผลลัพธ์ใหม่** ด้วยตำแหน่งที่แก้ไขแล้ว
4. **บันทึกข้อมูล** สำหรับการพัฒนาต่อ

---

## 🔄 ขั้นตอนการทำงาน

### 1. การวิเคราะห์ภาพเริ่มต้น

```
┌─────────────┐
│  อัปโหลดภาพ  │
│   X-ray     │
└──────┬──────┘
       │
       ▼
┌──────────────────┐
│  AI ตรวจจับจุดสำคัญ │
│  (YOLO Model)    │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  แสดงผลลัพธ์บน UI │
│  - จุดสำคัญ       │
│  - การวิเคราะห์   │
│  - การทำนาย      │
└──────────────────┘
```

### 2. การแก้ไขจุดสำคัญ

```
┌──────────────────┐
│  กดปุ่ม           │
│  "Edit Landmarks"│
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  เปิดโหมดแก้ไข     │
│  - จุดสำคัญ       │
│    พร้อมลาก       │
│  - แสดงตำแหน่ง    │
│    ปัจจุบัน       │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  ผู้ใช้ลาก        │
│  จุดสำคัญไป       │
│  ตำแหน่งใหม่      │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  Preview         │
│  ผลลัพธ์ใหม่      │
│  (Real-time)     │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  กดปุ่ม           │
│  "Save &         │
│   Recalculate"   │
└──────┬───────────┘
       │
       ▼
```

### 3. การคำนวณผลลัพธ์ใหม่

```
┌──────────────────┐
│  Backend         │
│  รับจุดสำคัญใหม่   │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  1. อัปเดต        │
│     ตำแหน่งจุดสำคัญ │
│     ในฐานข้อมูล    │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  2. สร้างรูปภาพ    │
│     ใหม่ที่มี       │
│     จุดสำคัญที่      │
│     แก้ไขแล้ว      │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  3. คำนวณใหม่      │
│     - วิเคราะห์     │
│       ทันตกรรม      │
│     - ROI         │
│       Classification│
│     - การทำนาย      │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  4. บันทึกข้อมูล    │
│     - จุดสำคัญ      │
│       ที่แก้ไข      │
│     - รูปภาพ       │
│       Original    │
│     - ข้อมูล       │
│       Metadata    │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│  5. ส่งผลลัพธ์     │
│     กลับไปยัง      │
│     Frontend     │
└──────────────────┘
```

---

## 🧩 ส่วนประกอบของระบบ

### Frontend Components

#### 1. **PredictionPanel** (`predictionPanel.tsx`)
- แสดงผลการวิเคราะห์
- จัดการโหมดแก้ไข
- ส่งคำขอ API

#### 2. **MeasurementCanvasPanel** (`measurementCanvasPanel.tsx`)
- แสดงภาพ X-ray
- วาดจุดสำคัญและเส้นวัด
- รองรับการลากจุดสำคัญ (Drag & Drop)

#### 3. **Keypoint Editing Flow**
```typescript
// State Management
const [isEditingKeypoints, setIsEditingKeypoints] = useState(false);
const [editedKeypoints, setEditedKeypoints] = useState([]);

// เมื่อกด Edit Landmarks
onClick={() => {
  setIsEditingKeypoints(true);
  setEditedKeypoints([...result.keypoints]);
}}

// เมื่อลากจุดสำคัญ
onMouseMove={(e) => {
  // คำนวณตำแหน่งใหม่
  const newX = calculateNewX(e);
  const newY = calculateNewY(e);
  // อัปเดต editedKeypoints
}}

// เมื่อกด Save
onClick={async () => {
  await axiosInstance.put(
    `/detection/${detectionId}/keypoints`,
    { keypoints: editedKeypoints }
  );
}}
```

### Backend Components

#### 1. **API Endpoints** (`routes/prediction.py`)

##### Preview Endpoint
```python
POST /detection/<id>/keypoints/preview
```
- รับจุดสำคัญใหม่
- คำนวณผลลัพธ์แบบชั่วคราว
- ไม่บันทึกลงฐานข้อมูล

##### Update Endpoint
```python
PUT /detection/<id>/keypoints
```
- รับจุดสำคัญใหม่
- บันทึกลงฐานข้อมูล
- สร้างรูปภาพใหม่
- คำนวณผลลัพธ์ใหม่
- บันทึกข้อมูลสำหรับ Export

#### 2. **Service Layer** (`services/keypoint_detection.py`)

##### `recalculate_analysis_with_keypoints()`
```python
def recalculate_analysis_with_keypoints(detection_id, updated_keypoints):
    # 1. อัปเดต keypoints ในฐานข้อมูล
    # 2. บันทึก CorrectedKeypoint
    # 3. คำนวณ dental analysis ใหม่
    # 4. คำนวณ ROI classification ใหม่
    # 5. สร้างรูปภาพใหม่
    # 6. บันทึก CorrectedImage
    # 7. ส่งผลลัพธ์กลับ
```

##### `generate_result_image_with_keypoints()`
```python
def generate_result_image_with_keypoints(image_path, keypoints_dict):
    # 1. โหลดรูปภาพ original
    # 2. วาดจุดสำคัญแต่ละจุด
    # 3. วาด label ของจุดสำคัญ
    # 4. บันทึกรูปภาพใหม่
```

#### 3. **Database Models** (`models/keypoint.py`)

##### Keypoint Model
- เก็บตำแหน่งจุดสำคัญปกติ

##### CorrectedKeypoint Model
- เก็บข้อมูลจุดสำคัญที่แก้ไข
- เก็บตำแหน่งเดิมและตำแหน่งใหม่
- เก็บ confidence score

##### CorrectedImage Model
- เก็บข้อมูลรูปภาพที่แก้ไข
- เก็บ path ของรูป original
- เก็บ keypoints ทั้งหมดเป็น JSON

---

## 💾 การเก็บข้อมูล

### 1. ฐานข้อมูล

#### Table: `corrected_keypoints`
```
┌─────────────┬──────────────┬─────────────┐
│ id          │ detection_id │ label       │
├─────────────┼──────────────┼─────────────┤
│ x_coord     │ y_coord      │ confidence  │
├─────────────┼──────────────┼─────────────┤
│ original_x  │ original_y   │ original_   │
│             │              │ confidence  │
├─────────────┼──────────────┼─────────────┤
│ corrected_at│ user_id      │             │
└─────────────┴──────────────┴─────────────┘
```

#### Table: `corrected_images`
```
┌─────────────┬──────────────┬─────────────┐
│ id          │ detection_id │ user_id     │
├─────────────┼──────────────┼─────────────┤
│ original_   │ corrected_   │ keypoints_  │
│ image_path  │ result_path  │ json        │
├─────────────┼──────────────┼─────────────┤
│ corrected_at│ notes        │             │
└─────────────┴──────────────┴─────────────┘
```

### 2. ไฟล์ระบบ

#### โฟลเดอร์ `corrected_images/`
```
corrected_images/
├── {detection_id}_{original_filename}.jpg
└── {detection_id}_corrected_{result_filename}.jpg
```

---

## 📤 การ Export ข้อมูล

### Admin Panel: Image Management

#### 1. ดูรายการภาพที่แก้ไข
- แสดง thumbnail
- แสดงจำนวนจุดสำคัญ
- แสดงวันที่แก้ไข

#### 2. Export ข้อมูล
- **Export แบบ ZIP**:
  ```
  corrected_image_{id}.zip
  ├── image_original.jpg
  └── data.json
  ```

- **ข้อมูลใน JSON**:
  ```json
  {
    "id": 1,
    "detection_id": "1234567890",
    "keypoints": [
      {
        "label": "m1",
        "x": 100.5,
        "y": 200.3,
        "confidence": 0.95
      }
    ],
    "corrected_at": "2024-01-01T12:00:00",
    "export_metadata": {
      "format": "zip",
      "description": "For training/development"
    }
  }
  ```

### การใช้งานข้อมูล Export

ข้อมูลที่ export สามารถนำไปใช้:
1. **Training Model**: ใช้เป็น ground truth สำหรับเทรนโมเดล
2. **Validation**: ตรวจสอบความถูกต้องของโมเดล
3. **Development**: พัฒนาและปรับปรุงระบบ

---

## 🎨 Flow Diagram แบบละเอียด

```
┌─────────────────────────────────────────────────────────┐
│                    USER INTERFACE                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────┐      ┌──────────────┐               │
│  │  Display     │      │  Edit Mode   │               │
│  │  Keypoints   │─────▶│  Activated   │               │
│  └──────────────┘      └──────────────┘               │
│         │                      │                        │
│         │                      ▼                        │
│         │              ┌──────────────┐                │
│         │              │  Drag & Drop │                │
│         │              │  Keypoints   │                │
│         │              └──────────────┘                │
│         │                      │                        │
│         │                      ▼                        │
│         │              ┌──────────────┐                │
│         │              │  Preview API │                │
│         │              │  (Optional)  │                │
│         │              └──────────────┘                │
│         │                      │                        │
│         │                      ▼                        │
│         │              ┌──────────────┐                │
│         └─────────────▶│  Save &      │                │
│                        │  Recalculate │                │
│                        └──────────────┘                │
│                                                         │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│                    BACKEND API                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────────────────────────────┐              │
│  │  PUT /detection/<id>/keypoints       │              │
│  └──────────┬───────────────────────────┘              │
│             │                                           │
│             ▼                                           │
│  ┌──────────────────────────────────────┐              │
│  │  KeypointDetectionService            │              │
│  │  .recalculate_analysis_with_keypoints│              │
│  └──────────┬───────────────────────────┘              │
│             │                                           │
│             ├─────▶ Update Database                    │
│             ├─────▶ Generate New Image                 │
│             ├─────▶ Recalculate Analysis               │
│             └─────▶ Save CorrectedImage                │
│                                                         │
└────────────────────────┬────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│                  DATABASE & FILES                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  Keypoints   │  │  Corrected   │  │  Corrected   │ │
│  │  Table       │  │  Keypoints   │  │  Images      │ │
│  │              │  │  Table       │  │  Table       │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                         │
│  ┌──────────────────────────────────────┐              │
│  │  corrected_images/                   │              │
│  │  ├── original images                 │              │
│  │  └── corrected result images         │              │
│  └──────────────────────────────────────┘              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔑 จุดสำคัญของระบบ

### 1. **Real-time Preview**
- ผู้ใช้สามารถเห็นผลลัพธ์ก่อนบันทึก
- ช่วยให้มั่นใจว่าการแก้ไขถูกต้อง

### 2. **Validation**
- ตรวจสอบว่า detection ถูกแก้ไขแล้วหรือยัง
- อนุญาตให้แก้ไขได้ครั้งเดียวต่อ detection

### 3. **Data Integrity**
- บันทึกทั้งตำแหน่งเดิมและตำแหน่งใหม่
- เก็บประวัติการแก้ไข

### 4. **Export Ready**
- ข้อมูลพร้อม export สำหรับ training
- รูปภาพ original และ keypoints ครบถ้วน

---

## 📊 สถิติและการใช้งาน

### ข้อมูลที่บันทึก
- จำนวนจุดสำคัญที่แก้ไข
- ผู้ใช้ที่แก้ไข
- วันที่และเวลาแก้ไข
- Confidence score

### การตรวจสอบคุณภาพ
- เปรียบเทียบตำแหน่งเดิมและใหม่
- วิเคราะห์ความผิดพลาดของ AI
- ประเมินความแม่นยำ

---

## 🎯 สรุป

ระบบแก้ไขจุดสำคัญช่วยให้:
1. ✅ แก้ไขข้อผิดพลาดของ AI ได้ง่าย
2. ✅ คำนวณผลลัพธ์ใหม่ได้ทันที
3. ✅ เก็บข้อมูลสำหรับพัฒนาโมเดล
4. ✅ Export ข้อมูลพร้อมใช้งาน

---

*เอกสารนี้จัดทำเพื่ออธิบายระบบแก้ไขจุดสำคัญสำหรับการนำเสนอ*
